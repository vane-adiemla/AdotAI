# -*- coding: utf-8 -*-
"""Pet agent

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1HU0VhlBCtVu5WWjrBPZVzpxNoYxxBRnx
"""

# Commented out IPython magic to ensure Python compatibility.
# %pip -q install google-genai

# Configura a API Key do Google Gemini

import os
from google.colab import userdata

os.environ["GOOGLE_API_KEY"] = userdata.get('GOOGLE_API_KEY')

# Instalar Framework de agentes do Google ################################################
!pip install -q google-adk

from google import genai
from google.adk.agents import Agent
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService
from google.adk.tools import google_search  # Importante para permitir buscas
from google.genai import types
from IPython.display import display, Markdown
import textwrap
import warnings

warnings.filterwarnings("ignore")

client = genai.Client()
MODEL_ID = "gemini-2.0-flash"

def call_agent(agent: Agent, message_text: str) -> str:
    session_service = InMemorySessionService()
    session = session_service.create_session(app_name=agent.name, user_id="user1", session_id="session1")
    runner = Runner(agent=agent, app_name=agent.name, session_service=session_service)
    content = types.Content(role="user", parts=[types.Part(text=message_text)])

    final_response = ""
    for event in runner.run(user_id="user1", session_id="session1", new_message=content):
        if event.is_final_response():
            for part in event.content.parts:
                if part.text is not None:
                    final_response += part.text
                    final_response += "\n"
    return final_response


def to_markdown(text):
    text = text.replace('â€¢', '  *')
    return Markdown(textwrap.indent(text, '> ', predicate=lambda _: True))


####################################################
# --- Agente de AdoÃ§Ã£o: OrientaÃ§Ãµes e FormulÃ¡rio --- #
####################################################

adocao_agent = Agent(
    name="agente_adocao",
    model=MODEL_ID,  # Use o mesmo MODEL_ID definido anteriormente
    instruction="""
    VocÃª Ã© um assistente de adoÃ§Ã£o de animais. Sua tarefa Ã© ajudar pessoas interessadas
    no processo de adoÃ§Ã£o, fornecendo informaÃ§Ãµes, respondendo perguntas e guiando-as
    para o preenchimento de um formulÃ¡rio (link fictÃ­cio fornecido para demonstraÃ§Ã£o).

    Siga estas etapas:

    1. Cumprimente o usuÃ¡rio e pergunte como pode ajudar.
    2. Responda a perguntas sobre adoÃ§Ã£o, como requisitos, cuidados com os animais, etc.
            Use a ferramenta google_search para buscar informaÃ§Ãµes adicionais, se necessÃ¡rio.
    3. OfereÃ§a o link para o formulÃ¡rio de adoÃ§Ã£o: [https://docs.google.com/forms/d/e/1FAIpQLSe7hDZPL59al_Gd1369i6p6Yx736SHhexiCl-NtMB9oYQHyTw/viewform?usp=header].
    4. Se o usuÃ¡rio tiver dÃºvidas sobre o formulÃ¡rio, ajude-o a preenchÃª-lo.
    5. AgradeÃ§a ao usuÃ¡rio e finalize a conversa.

    Seja amigÃ¡vel, prestativo e encoraje a adoÃ§Ã£o responsÃ¡vel.
    """,
    description="Agente para auxiliar no processo de adoÃ§Ã£o de animais.",
    tools=[google_search]  # Adicione a ferramenta google_search
)



# --- Loop principal aprimorado ---

print("ğŸ¾ Agente de AdoÃ§Ã£o de Animais ğŸ¾")
print("Oi! Eu posso te ajudar com adoÃ§Ã£o de animais. Pode perguntar sobre os animais disponÃ­veis, cuidados, ou pedir o formulÃ¡rio ğŸ¶ğŸ±")
planilha_animais_disponiveis = "https://docs.google.com/spreadsheets/d/1U3EBw1YZR0Qt_iqeWZD0rb2kpbogJENbyIe72XXRXws/edit?usp=sharing"



while True:
    user_input = input("â“ Como posso ajudar? (Digite 'sair' para encerrar): ").lower().strip()

    if user_input in ["sair", "encerrar", "tchau"]:
        print("Foi um prazer te ajudar! Obrigado por considerar a adoÃ§Ã£o responsÃ¡vel ğŸ’šğŸ¾")
        break

    elif "adotar" in user_input and "gato" in user_input:
        print("\nğŸ˜º Que Ã³timo que quer adotar um gatinho! VocÃª pode ver alguns dos animais disponÃ­veis aqui:")
        print("ğŸ“‹ Planilha com animais para adoÃ§Ã£o: https://docs.google.com/spreadsheets/d/1U3EBw1YZR0Qt_iqeWZD0rb2kpbogJENbyIe72XXRXws/edit?usp=sharing")
        print("Se gostar de algum, preencha este formulÃ¡rio: https://docs.google.com/forms/d/e/1FAIpQLSe7hDZPL59al_Gd1369i6p6Yx736SHhexiCl-NtMB9oYQHyTw/viewform?usp=header")

    elif "formulÃ¡rio" in user_input or "formulario" in user_input:
        print("\nğŸ“ VocÃª pode preencher o formulÃ¡rio por este link:")
        print("ğŸ‘‰ https://docs.google.com/forms/d/e/1FAIpQLSe7hDZPL59al_Gd1369i6p6Yx736SHhexiCl-NtMB9oYQHyTw/viewform?usp=header")
        print("Se tiver dÃºvidas sobre o que preencher, Ã© sÃ³ me perguntar!")

    elif "castraÃ§Ã£o" in user_input or "castrado" in user_input:
        print("\nğŸ“Œ Todos os nossos animais sÃ£o castrados antes da adoÃ§Ã£o. Isso Ã© fundamental para o bem-estar deles e para evitar abandonos futuros.")
        print("Se tiver dÃºvidas sobre o procedimento ou benefÃ­cios, posso te explicar mais!")

    elif "vacina" in user_input:
        print("\nğŸ’‰ Nossos animais sÃ£o entregues com a vacinaÃ§Ã£o em dia, conforme a idade. Caso precise saber sobre reforÃ§os ou vacinas obrigatÃ³rias, posso te ajudar!")

    elif "adoÃ§Ã£o responsÃ¡vel" in user_input or "responsÃ¡vel" in user_input:
        print("\nğŸ¾ AdoÃ§Ã£o responsÃ¡vel significa garantir que o animal tenha um lar seguro, com alimentaÃ§Ã£o, atenÃ§Ã£o, cuidados veterinÃ¡rios e muito amor.")
        print("Se quiser, posso te enviar uma checklist para avaliar se estÃ¡ tudo pronto pra receber um novo amigo!")

    else:
        # fallback: deixar o agente Gemini responder
        response = call_agent(adocao_agent, user_input)
        display(to_markdown(response))

    print("--------------------------------------------------------------")